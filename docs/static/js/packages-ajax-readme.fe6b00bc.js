(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"./packages/ajax/README.mdx":function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return x}));var n=t("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),r=t("./node_modules/react/index.js"),s=t.n(r),c=t("./node_modules/@mdx-js/react/dist/esm.js"),b=t("./node_modules/docz/dist/index.esm.js"),i=t("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),l=t("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js"),p=t("./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js"),o=function(e){Object(l.a)(t,e);var a=Object(p.a)(t);function t(){return Object(i.a)(this,t),a.apply(this,arguments)}return t}(s.a.Component);"undefined"!==typeof o&&o&&o===Object(o)&&Object.isExtensible(o)&&Object.defineProperty(o,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"ResultInterface",filename:"packages/ajax/__tests__/Doc.tsx"}});var j=function(e){Object(l.a)(t,e);var a=Object(p.a)(t);function t(){return Object(i.a)(this,t),a.apply(this,arguments)}return t}(s.a.Component);"undefined"!==typeof j&&j&&j===Object(j)&&Object.isExtensible(j)&&Object.defineProperty(j,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"ExtraFetchParamsInterface",filename:"packages/ajax/__tests__/Doc.tsx"}});var m=function(e){Object(l.a)(t,e);var a=Object(p.a)(t);function t(){return Object(i.a)(this,t),a.apply(this,arguments)}return t}(s.a.Component);"undefined"!==typeof m&&m&&m===Object(m)&&Object.isExtensible(m)&&Object.defineProperty(m,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"ParamsInterface",filename:"packages/ajax/__tests__/Doc.tsx"}});var u=function(e){Object(l.a)(t,e);var a=Object(p.a)(t);function t(){return Object(i.a)(this,t),a.apply(this,arguments)}return t}(s.a.Component);"undefined"!==typeof u&&u&&u===Object(u)&&Object.isExtensible(u)&&Object.defineProperty(u,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"FetchInterface",filename:"packages/ajax/__tests__/Doc.tsx"}});var d={};function x(e){var a=e.components,t=Object(n.a)(e,["components"]);return Object(c.b)("wrapper",Object.assign({},d,t,{components:a,mdxType:"MDXLayout"}),Object(c.b)("h1",{id:"ajax"},"Ajax"),Object(c.b)("p",null,"Tkit \u89c4\u8303 Ajax \u6a21\u5757\uff0c\u57fa\u4e8e Axios \u5c01\u88c5\uff0c\u652f\u6301 RESTful \u548c Graphql\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-shell"}),"npm i -S @ekit/ajax\n")),Object(c.b)("h2",{id:"2-api"},"2. API"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-ts"}),"import ajax from '@ekit/ajax';\n")),Object(c.b)("h2",{id:"--21-ajax"},"- 2.1. Ajax"),Object(c.b)("h3",{id:"ajax-1"},"Ajax"),Object(c.b)("p",null,"Ajax \u5b9e\u4f8b\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u65b9\u6cd5\u548c\u5c5e\u6027\uff1a"),Object(c.b)(b.d,{of:u,mdxType:"Props"}),Object(c.b)("h2",{id:"--22-ajaxajax"},"- 2.2. Ajax.ajax"),Object(c.b)("p",null,"Ajax \u5b9e\u4f8b\u7684 ajax \u65b9\u6cd5\u63a5\u6536 ",Object(c.b)("a",Object.assign({parentName:"p"},{href:"#wrappedfetchparams-%E6%8E%A5%E5%8F%A3"}),"WrappedFetchParams")," \u7c7b\u578b\u7684\u53c2\u6570\uff1a"),Object(c.b)("h3",{id:"wrappedfetchparams-\u63a5\u53e3"},"WrappedFetchParams \u63a5\u53e3"),Object(c.b)("p",null,"WrappedFetchParams \u7ee7\u627f\u81ea ",Object(c.b)("a",Object.assign({parentName:"p"},{href:"#extrafetchparams-%E6%8E%A5%E5%8F%A3"}),"ExtraFetchParams")),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-ts"}),"interface WrappedFetchParams extends ExtraFetchParams {}\n")),Object(c.b)("p",null,"WrappedFetchParams \u5305\u542b\u4ee5\u4e0b\u5c5e\u6027\uff1a"),Object(c.b)(b.d,{of:m,mdxType:"Props"}),Object(c.b)("h3",{id:"extrafetchparams-\u63a5\u53e3"},"ExtraFetchParams \u63a5\u53e3"),Object(c.b)("p",null,"WrappedFetchParams \u7ee7\u627f\u7684 ExtraFetchParams \u5305\u542b\u4ee5\u4e0b\u5c5e\u6027\uff1a"),Object(c.b)(b.d,{of:j,mdxType:"Props"}),Object(c.b)("h3",{id:"example"},"Example"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-ts"}),"ajax.ajax({\n  method: 'GET',\n  url: '//xxxx.com'\n});\n")),Object(c.b)("h2",{id:"--23-tkit-\u89c4\u8303\u63a5\u53e3"},"- 2.3 Tkit \u89c4\u8303\u63a5\u53e3"),Object(c.b)("p",null,"\u54cd\u5e94\u6570\u636e\u7ed3\u6784\u9075\u5faa Tkit \u7ea6\u5b9a\u7684\u7ed3\u6784 ",Object(c.b)("a",Object.assign({parentName:"p"},{href:"#tkitabstractajaxresult-%E6%8E%A5%E5%8F%A3"}),"TkitAbstractAjaxResult"),"\uff1a"),Object(c.b)("h3",{id:"tkitabstractajaxresult-\u63a5\u53e3"},"TkitAbstractAjaxResult \u63a5\u53e3"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-ts"}),"interface TkitAbstractAjaxResult<R> {\n  code?: number;\n  message?: null | string;\n  result: R;\n}\ntype TkitAjaxResult = TkitAbstractAjaxResult<any>;\n")),Object(c.b)(b.d,{of:o,mdxType:"Props"}),Object(c.b)("h3",{id:"\u793a\u4f8b"},"\u793a\u4f8b"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-ts"}),"import ajax, { TkitAjaxResult, TkitAjaxFunction, AjaxPromise } from '@ekit/ajax';\n\nconst res: TkitAjaxResult = { code: 0, result: { id: 2 } };\nconst fetchData: TkitAjaxFunction = async () => res;\nconst fetchData2: () => AjaxPromise<{ code: number; result: { id: number } }> = async () => res;\n")),Object(c.b)("h2",{id:"--24-\u5176\u4ed6\u63a5\u53e3\u89c4\u8303"},"- 2.4 \u5176\u4ed6\u63a5\u53e3\u89c4\u8303"),Object(c.b)("p",null,"\u54cd\u5e94\u6570\u636e\u7ed3\u6784\u4e0d\u9075\u5faa Tkit \u89c4\u8303\u7684\u63a5\u53e3\uff0c\u8bf7\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u64cd\u4f5c\u3002"),Object(c.b)("p",null,"\u9996\u5148\u914d\u7f6e tsconfig.json\uff1a"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-json"}),'{\n  "paths": {\n    "@ajax": ["src/utils/standard-ajax"]\n  }\n}\n')),Object(c.b)("p",null,"\u7136\u540e\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684 standard-ajax.ts\uff0c\u6bd4\u5982\uff1a"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-ts"}),"export * from '@ekit/ajax';\nexport { NonStandardAjaxPromise as AjaxPromise } from '@ekit/ajax';\nexport { default } from '@ekit/ajax';\n")),Object(c.b)("h2",{id:"--25-ajax-\u5168\u5c40\u4e8b\u4ef6"},"- 2.5. Ajax \u5168\u5c40\u4e8b\u4ef6"),Object(c.b)("p",null,"Tkit Ajax \u9ed8\u8ba4\u5f00\u542f\u7684\u81ea\u52a8\u9519\u8bef\u6355\u83b7\u91cc\uff08\u53ef\u901a\u8fc7\u8bbe\u7f6e Ajax \u793a\u4f8b autoCatch false \u5173\u95ed\uff09\uff0c\u5f53\u6355\u83b7\u5230 401\u3001403 \u9519\u8bef\u7684\u65f6\u5019\uff0c\u4f1a\u901a\u8fc7 @ekit/event \u629b\u51fa\u5168\u5c40\u4e8b\u4ef6\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-ts"}),"import { EventCenter } from '@ekit/event';\n\nEventCenter.on('common.user.status', (res: { code?: number; message?: string }) => {});\n")),Object(c.b)("h2",{id:"--26-axios-\u5168\u5c40\u914d\u7f6e"},"- 2.6. Axios \u5168\u5c40\u914d\u7f6e"),Object(c.b)("p",null,"\u6211\u4eec\u53ef\u4ee5\u5bf9 Ajax \u4f7f\u7528\u7684 Axios \u5b9e\u4f8b\u6dfb\u52a0\u4e00\u4e9b\u5168\u5c40\u8bbe\u7f6e\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-ts"}),"import axios from '@ekit/ajax/lib/axios';\n\n/** \u914d\u7f6e\u8bf7\u6c42\u5934 */\naxios.defaults.headers = {\n  ['X-TOKEN']: 'something secret'\n};\n\nimport qs from 'qs';\n\n/** \u914d\u7f6e\u5982\u4f55\u683c\u5f0f\u5316query\u91cc\u7684\u6570\u7ec4 */\naxios.defaults.paramsSerializer = (params) => qs.stringify(params, { arrayFormat: 'repeat' });\n")),Object(c.b)("h2",{id:"3-graphql"},"3. Graphql"),Object(c.b)("p",null,"\u57fa\u4e8e graphql-request \u5c01\u88c5\u7684 Axios \u7248\u672c"),Object(c.b)("h2",{id:"--31-\u914d\u7f6e-graphql-client"},"- 3.1. \u914d\u7f6e Graphql Client"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-ts"}),"import { GraphQLClient } from '@ekit/ajax/lib/graphql';\nimport { getSdk } from '@src/models/service';\n\nconst isProd = process.env.NODE_ENV !== 'development';\nconst endpoint = isProd ? '/graphql' : 'http://127.0.0.1/graphql';\n\nexport const Client = new GraphQLClient(endpoint, {\n  headers: {\n    'Access-Control-Allow-Origin': '*'\n  }\n});\n\n/** xx services */\nexport default getSdk(Client);\n")),Object(c.b)("h2",{id:"--32-service-\u793a\u4f8b"},"- 3.2. Service \u793a\u4f8b"),Object(c.b)("pre",null,Object(c.b)("code",Object.assign({parentName:"pre"},{className:"language-ts"}),"import { GraphQLClient } from '@ekit/ajax';\nimport { print } from 'graphql';\nimport gql from 'graphql-tag';\nimport { AjaxPromise, ExtraFetchParams } from '@ekit/ajax';\n\nexport function getSdk(client: GraphQLClient) {\n  return {\n    docList(\n      variables: DocListQueryVariables,\n      /** \u7528\u4ee5 cancel \u8bf7\u6c42 */\n      opt?: ExtraFetchParams\n    ): AjaxPromise<DocListQueryRes> {\n      return client.request<DocListQueryRes>(print(DocListDocument), variables, opt);\n    }\n  };\n}\n")))}x&&x===Object(x)&&Object.isExtensible(x)&&Object.defineProperty(x,"__filemeta",{enumerable:!0,configurable:!0,value:{name:"MDXContent",filename:"packages/ajax/README.mdx"}}),x.isMDXComponent=!0}}]);
//# sourceMappingURL=packages-ajax-readme.0d76d0e85c54bdcee71e.js.map